<!DOCTYPE html>
<script>
// Called when a message is passed.  We assume that the content script
// wants to show the page action.
function onRequest(request, sender, sendResponse) {
	// Show the page action for the tab that the sender (content script) was on.
	chrome.pageAction.show(sender.tab.id);

	// Return nothing to let the connection be cleaned up.
	sendResponse({});
};

// Listen for the content script to send a message to the background page.
chrome.extension.onRequest.addListener(onRequest);

function focusOrCreateTab(url) {
  chrome.windows.getAll({"populate":true}, function(windows) {
    var existing_tab = null;
    for (var i in windows) {
      var tabs = windows[i].tabs;
      for (var j in tabs) {
        var tab = tabs[j];
        if (tab.url == url) {
          existing_tab = tab;
          break;
        }
      }
    }
    if (existing_tab) {
      chrome.tabs.update(existing_tab.id, {"selected":true});
    } else {
      chrome.tabs.create({"url":url, "selected":true});
    }
  });
}




/*
 * Called when the pageAction icon is clicked
 * Open a new tab which shows the current issues page in Ghello mode
 */ 
chrome.pageAction.onClicked.addListener(function(tab) {
	var url = tab.url;
	var parts = url.split('/');

	var user = parts[3];
	var repo = parts[4];

	var board_url = chrome.extension.getURL('board.html?user='+user+'&repo='+repo);
	focusOrCreateTab(board_url);

});

</script>
